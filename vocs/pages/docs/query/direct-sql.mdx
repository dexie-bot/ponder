# Direct SQL [Query indexed data directly in Postgres]

It's often useful to query indexed data directly in Postgres rather than over HTTP.

## Limitations

- **Direct SQL queries are read-only**. Direct SQL queries cannot insert, update, or delete rows from Ponder tables.
- **Direct SQL with zero downtime requires additional setup**. [Read more](/docs/production/overview) in the production guide.
- **Triggers on Ponder tables are not supported**.

In general, the _only_ supported operation for direct SQL is `SELECT` queries against Ponder tables.

## Database schema

Ponder uses **database schemas** to isolate deployments. Each deployment uses a different schema.

Whenever you write a direct SQL query, first confirm that your queries are targeting the correct database schema.

## Query

### psql

### Drizzle

## Join onchain and offchain data

It's often useful to join Ponder-managed data with other tables in your database.

:::code-group

```ts [Drizzle]
import { setDatabaseSchema } from "@ponder/client";
import { drizzle } from "drizzle-orm/node-postgres";
import * as _schema from "../../ponder/ponder.schema";

const schema = setDatabaseSchema(_schema, "my_schema");

const db = drizzle(process.env.DATABASE_URL, { schema, casing: "snake_case" });

// Basic select
const oldAccounts = await db
  .select()
  .from(schema.accounts)
  .orderBy(asc(schema.accounts.createdAt))
  .limit(100);

// Drizzle Relations query
const whalesWithTransfers = await db.query.accounts.findMany({
  where: (accounts, { eq }) => eq(accounts.balance, 1_000_000n),
  with: { transferEvents: true },
});
```

```sql [SQL]

```

:::

## Live views pattern

In production, each new Ponder deployment within a project creates tables in a different database schema. [Read more](/docs/production/overview) about this design pattern in the production guide.

### Problem: Schema changes on each deployment

If you query Ponder tables directly, you'll soon run into a problem. On each new deployment, the schema containing the _latest_ deployment's tables (the ones you want to query) will change.

To avoid querying the wrong tables, downstream systems will need to be updated on _every_ new deployment. What a pain!

### Solution: Database views as a "proxy"

When you query a Ponder project over HTTP, this problem is typically solved at the orchestration layer through healthchecks, blue/green deployments, and an HTTP proxy.

To simulate the same behavior at the SQL level, we recommend using **database views** that always "proxy" queries to the latest deployment's tables.

The `ponder db create-views` CLI command creates (or updates) views in the target schema to point at the specified deployment's tables.
